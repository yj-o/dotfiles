#!/bin/sh

# Source environment variables from ~/.env
if [[ "$(uname)" != "Darwin" && -f "$HOME/.env" ]]; then
    source "$HOME/.env"
fi

if [[ "$(uname)" == "Darwin" ]]; then

    if ! command -v brew >/dev/null 2>&1; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
    brew update
    brew upgrade
    brew install gnupg
else
    sudo apt update -y
    sudo apt upgrade -y
    sudo apt install gnupg -y
fi

# Source my zshrc from config
if ! grep -Fxq 'source "$HOME/.myzsh"' ~/.zshrc; then
    echo 'source "$HOME/.myzsh"' >> ~/.zshrc
fi


echo "Updating the yadm repo origin URL"
yadm remote set-url origin "git@github.com:yj-o/dotfiles.git"

echo "add ssh key for github"
export GPG_TTY=$(tty)
yadm decrypt
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/gh.key

echo "add extra repo"
# sudo apt update -y

# echo "install apps..."
# sudo apt install git -y
# sudo apt install curl -y
# sudo apt install micro -y
# sudo apt install net-tools -y


# echo "install zoxide"
# curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash


# echo "install fzf"
# curl -fLo $HOME/fzf_install https://raw.githubusercontent.com/junegunn/fzf/master/install && chmod a+x $HOME/fzf_install
# mv ~/bin/fzf $XDG_BIN
# rm -d ~/bin
# rm ~/fzf_install


# echo "install zellij"
# chmod +x $HOME/.local/install/install_zellij.sh
# .$HOME/.local/install/install_zellij.sh
